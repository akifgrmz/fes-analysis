---
title: "Occlusion Est Error"
output: html_document
date: "2023-09-06"
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r including libraries, display=FALSE}
library(magrittr); 
library(here); 
library(janitor)
library(readxl);
library(tidyverse)
library(rmdformats)
library(Epi)
library(vcd)
library(broom)
library(patchwork)
library(vcd)
library(dplyr)
library(ggplot2)
```



```{r Data Inject } 

err_raw<- read_csv("occ_est_error.csv",show_col_types = FALSE)
err_raw

droppedocc<- read_csv("dropped_occ.csv",show_col_types = FALSE)
droppedocc

```



```{r dataframe modifications}


err<-err_raw%>%mutate(MVC_Voli_Cat=recode(VoliMVC,
                                '10' = 'Voli_10',
                                '20' = 'Voli_20',
                                '30' = 'Voli_30',
                                '40' = 'Voli_40')) %>%
            mutate(MVC_Stim_Cat=recode(StimMVC,
                                 '0' = 'Stim_0',
                                '10' = 'Stim_10',
                                '20' = 'Stim_20',
                                '30' = 'Stim_30'))

err<-err%>%mutate(Test = as.factor(Test),
                     Filt = as.factor(Filt),
                     MVC_Stim_Cat = as.factor(MVC_Stim_Cat),
                     MVC_Voli_Cat = as.factor(MVC_Voli_Cat),
                     MVC_Stim = as.integer(StimMVC),
                      MVC_Voli = as.integer(VoliMVC))

err_raw<-err%>%filter(Test!="mar7",Test!="mar16",Test!="feb27")

droppedocc<-droppedocc%>%mutate(MVC_Voli_Cat=recode(VoliMVC,
                                '10' = 'Voli_10',
                                '20' = 'Voli_20',
                                '30' = 'Voli_30',
                                '40' = 'Voli_40')) %>%
            mutate(MVC_Stim_Cat=recode(StimMVC,
                                 '0' = 'Stim_0',
                                '10' = 'Stim_10',
                                '20' = 'Stim_20',
                                '30' = 'Stim_30'))


droppedocc<-droppedocc%>%mutate(Test = as.factor(Test),
                     StimMVC = as.factor(StimMVC),
                     Repeat = as.factor(Repeat),
                     NumofDropped = as.factor(NumofDropped))

summary(err)

```


```{r Plotting: maintain section  }
filt="GS"
occ_err<-filter(err, MVC_Stim_Cat!="Stim_0",Filt==filt)

occ_err1<-filter(err, MVC_Stim_Cat!="Stim_0")

p1<-ggplot(occ_err, aes(x =  VoliMVC , y = Effort_err_Amp , color = MVC_Stim_Cat)) +
    geom_point() +
    geom_smooth(method = "lm")+ 
    labs(x = "Volitional Effort: F_v (% MVC)",
    y = "Effort Estimation Error (% MVC)",
    title = "Effort Estimation Error before Occlusion Correction",
    subtitle = sprintf('%s filtered results',filt))

p2<-ggplot(occ_err, aes(x =  VoliMVC , y = Effort_err_Amp_Occ , color = MVC_Stim_Cat)) +
    geom_point() +
    geom_smooth(method = "lm")+ 
    labs(x = "Volitional Effort: F_v (% MVC)",
    y = "Effort Estimation Error (% MVC)",
    title = "Effort Estimation Error after Occlusion Correction",
    subtitle = sprintf(' %s filtered results',filt))

p3<-ggplot(occ_err1, aes(x =  VoliMVC , y = Effort_err_Amp , color = Filt)) +
    geom_point() +
    geom_smooth(method = "lm")+ 
    labs(x = "Volitional Effort: F_v (% MVC)",
    y = "Effort Estimation Error (% MVC)",
    title = "",
    subtitle = " Comparing Different Filters")
p1/p2 -p3


```

```{r linear models}
occ_err_lm<-filter(err, MVC_Stim_Cat!="Stim_0",Filt!="Unfilt" )
occ_err_lm <- occ_err_lm %>%
  mutate(Filt = relevel(Filt, ref = "Comb"))

  m1 <- lm(Effort_err_Amp_Occ ~ Filt, data = occ_err_lm) 
tidy(m1,conf.int = TRUE ,conf.level =0.95) %>% knitr::kable(digits = 3)

  m2 <- lm(Effort_err_Amp_Occ ~ MVC_Voli_Cat, data = filter(err, MVC_Stim_Cat!="Stim_0",Filt=="GS" )) 
tidy(m2,conf.int = TRUE ,conf.level =0.95) %>% knitr::kable(digits = 3)

```

The average error for GS is -1.5 while Comb filter estimates an average of -1.5+7.6=6.1. a0 and a1 values are -1.5 and 7.6.

Effort estimation error with comb filter is higher with and average of 6.4 compared to GS filter.


```{r Dropeed frames error }

dropped_err<-filter(droppedocc, NumofDropped =='1_Drops')

p3<-ggplot(dropped_err, aes(x =  VoliMVC , y = Occ_MAV, color = StimMVC))+
  geom_point() +
  geom_smooth(method = "lm",level=0.90) +
  labs(x = "Volitional MVC",
       y = "Occluded Effort (% MVC)",
       title = "Occluded effort from the dropped frames",
       subtitle = "MAV_dropped-MAV_nostim")
#  geom_segment(aes(x = 10, y = 10, xend = 40, yend = 40, color='No Occlusion Level'))+
#      facet_wrap(~Test)
p3
```


```{r linear models }
#dropped_err <- dropped_err %>%
#  mutate(Filt = relevel(Filt, ref = "Comb"))

  m4 <- lm(Occ_MAV ~ MVC_Voli_Cat, data = dropped_err) 
tidy(m4,conf.int = TRUE ,conf.level =0.95) %>% knitr::kable(digits = 3)

```



